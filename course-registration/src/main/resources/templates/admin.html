<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f9; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }

        /* í—¤ë” ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (ì œëª© + ë¡œê·¸ì•„ì›ƒ) */
        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #ddd; padding-bottom: 15px; }
        .header-box h2 { margin: 0; color: #333; }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: #eee; }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }

        /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .btn { width: 100%; background-color: #2ecc71; color: white; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn:hover { background-color: #27ae60; }

        /* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-logout { background-color: #6c757d; color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 4px; font-weight: bold; margin-left: 10px; }
        .btn-logout:hover { background-color: #5a6268; }
    </style>
</head>
<body>

<div class="container">

    <div class="header-box">
        <h2>ğŸ“‹ ê°•ì˜ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
        <div>
            <span style="color: #555; font-weight: bold;">
                <span th:text="${#authentication?.name}">ê´€ë¦¬ì</span>ë‹˜ (Admin)
            </span>
            <button onclick="logout()" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <h3>ğŸ“Œ í˜„ì¬ ê°œì„¤ëœ ê°•ì˜</h3>
    <table>
        <thead>
        <tr>
            <th>No</th>
            <th>ê°•ì˜ëª…</th>
            <th>êµìˆ˜ë‹˜</th>
            <th>ì‹œê°„</th>
            <th>ì‹ ì²­í˜„í™©</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="lecture : ${lectures}">
            <td th:text="${lecture.id}">1</td>
            <td th:text="${lecture.lectureName}">ì•Œê³ ë¦¬ì¦˜</td>
            <td th:text="${lecture.professor}">ë°©ì˜ì² </td>
            <td th:text="${lecture.time}">ì›” 1êµì‹œ</td>
            <td>
                <span th:text="${lecture.currentCount}">0</span> /
                <span th:text="${lecture.maxStudent}">50</span>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(lectures)}">
            <td colspan="5">ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
        </tbody>
    </table>

    <hr>

    <h3>â• ìƒˆ ê°•ì˜ ë“±ë¡</h3>

    <form id="lectureForm">
        <div class="form-row">
            <input type="text" id="lectureName" placeholder="ê°•ì˜ëª… (ì˜ˆ: ìë°”)" required>
            <input type="text" id="professor" placeholder="êµìˆ˜ëª…" required>
        </div>
        <div class="form-row">
            <input type="number" id="grade" placeholder="í•™ë…„" required>
            <input type="number" id="credit" placeholder="í•™ì " required>
        </div>
        <div class="form-row">
            <input type="text" id="time" placeholder="ì‹œê°„ (ì˜ˆ: ì›”3)" required>
            <input type="number" id="maxStudent" placeholder="ì •ì›" required>
        </div>

        <button type="button" class="btn" onclick="registerLecture()">ê°•ì˜ ë“±ë¡í•˜ê¸°</button>
    </form>

</div>

<script>
    // 1. ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ (ì¿ í‚¤ ì‚­ì œ ì¶”ê°€ë¨!)
    function logout() {
        if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
        localStorage.removeItem("Authorization");
        localStorage.removeItem("access_token");

        // â˜… [í•µì‹¬] ì¿ í‚¤ ì‚­ì œ (ë§Œë£Œì‹œê°„ì„ 0ìœ¼ë¡œ ì„¤ì •í•´ì„œ ì¦‰ì‹œ ì‚­ì œ)
        document.cookie = "Authorization=; path=/; max-age=0";

        // ì„œë²„ ë¡œê·¸ì•„ì›ƒ í˜¸ì¶œ ë° ì´ë™
        fetch('/logout', { method: 'POST' })
            .then(() => location.href = "/login")
            .catch(() => location.href = "/login");
    }

    // 2. ê°•ì˜ ë“±ë¡ í•¨ìˆ˜
    function registerLecture() {
        if(!confirm("ì´ ê°•ì˜ë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        const data = {
            lectureName: document.getElementById('lectureName').value,
            professor: document.getElementById('professor').value,
            grade: document.getElementById('grade').value,
            credit: document.getElementById('credit').value,
            time: document.getElementById('time').value,
            maxStudent: document.getElementById('maxStudent').value
        };

        const token = localStorage.getItem("Authorization");

        fetch('/admin/lectures', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': token
            },
            body: JSON.stringify(data)
        })
        .then(async response => {
            if (response.ok) {
                alert("ê°•ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            } else {
                const errorText = await response.text();
                alert("ë“±ë¡ ì‹¤íŒ¨: " + errorText);
            }
        })
        .catch(error => {
            console.error(error);
            alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    }
</script>

</body>
</html>